<!DOCTYPE html>
<html>
<head>
    <title>Task Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-5">

    <h2 class="text-center mb-4">Task Manager</h2>

    <!-- Register -->
    <div class="card p-4 mb-4 shadow">
        <h4>Register</h4>
        <input class="form-control mb-2" id="reg-username" placeholder="Username">
        <input class="form-control mb-2" type="password" id="reg-password" placeholder="Password">
        <button class="btn btn-primary" onclick="register()">Register</button>
    </div>

    <!-- Login -->
    <div class="card p-4 mb-4 shadow">
        <h4>Login</h4>
        <input class="form-control mb-2" id="login-username" placeholder="Username">
        <input class="form-control mb-2" type="password" id="login-password" placeholder="Password">
        <button class="btn btn-success" onclick="login()">Login</button>
    </div>

    <!-- Add Task -->
    <div class="card p-4 mb-4 shadow">
        <h4>Add Task</h4>
        <input class="form-control mb-2" id="task-title" placeholder="Title">
        <input class="form-control mb-2" id="task-desc" placeholder="Description">
        <button class="btn btn-warning" onclick="addTask()">Add Task</button>
    </div>

    <!-- Tasks -->
    <div class="card p-4 shadow">
        <h4>My Tasks</h4>
        <ul id="task-list" class="list-group"></ul>
    </div>

</div>

<script>
let token = "";

// REGISTER
function register() {
    fetch('/register', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            username: document.getElementById('reg-username').value,
            password: document.getElementById('reg-password').value
        })
    })
    .then(res => res.json())
    .then(data => alert(data.msg));
}

// LOGIN
function login() {
    fetch('/login', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            username: document.getElementById('login-username').value,
            password: document.getElementById('login-password').value
        })
    })
    .then(res => res.json())
    .then(data => {
        token = data.access_token;
        alert("Login successful");
        loadTasks();
    });
}

// ADD TASK
function addTask() {
    fetch('/tasks', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + token
        },
        body: JSON.stringify({
            title: document.getElementById('task-title').value,
            description: document.getElementById('task-desc').value
        })
    })
    .then(res => res.json())
    .then(data => {
        alert(data.msg);
        loadTasks();
    });
}

// LOAD TASKS
function loadTasks() {
    fetch('/tasks', {
        headers: {
            'Authorization': 'Bearer ' + token
        }
    })
    .then(res => res.json())
    .then(tasks => {
        let list = document.getElementById('task-list');
        list.innerHTML = "";

        tasks.forEach(task => {
            list.innerHTML += `
                <li class="list-group-item d-flex justify-content-between">
                    <div>
                        <strong>${task.title}</strong><br>
                        ${task.description}<br>
                        <span class="badge bg-info">${task.status}</span>
                    </div>
                    <button class="btn btn-danger btn-sm" onclick="deleteTask(${task.id})">Delete</button>
                </li>
            `;
        });
    });
}

// DELETE TASK
function deleteTask(id) {
    fetch('/tasks/' + id, {
        method: 'DELETE',
        headers: {
            'Authorization': 'Bearer ' + token
        }
    })
    .then(res => res.json())
    .then(data => {
        alert(data.msg);
        loadTasks();
    });
}
</script>

</body>
</html>